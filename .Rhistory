theme_bw() +
theme(legend.position = 'none')
ggplot() +
geom_segment(data = blah$Y, aes(x = 0, y = 0, xend = PC1, yend = PC2), color = 'gray40', arrow = arrow(length = unit(0.05, 'inches'))) +
# geom_text_repel(data = blah$X, aes(x = PC1, y = PC2, label = rownames(blah$X), color = factor(clust_pca)), size = 3, bg.color = 'white') +
geom_text(data = blah$Y, aes(x = PC1 ** 1.1, y = PC2 ** 1.1, label = rownames(blah$Y)), color = 'gray40') +
theme_bw() +
theme(legend.position = 'none')
ggplot() +
geom_segment(data = blah$Y, aes(x = 0, y = 0, xend = PC1, yend = PC2), color = 'gray40', arrow = arrow(length = unit(0.05, 'inches'))) +
# geom_text_repel(data = blah$X, aes(x = PC1, y = PC2, label = rownames(blah$X), color = factor(clust_pca)), size = 3, bg.color = 'white') +
geom_text(data = blah$Y, aes(x = PC1 * 1.15, y = PC2 * 1.15, label = rownames(blah$Y)), color = 'gray40') +
theme_bw() +
theme(legend.position = 'none')
ggplot() +
geom_segment(data = blah$Y, aes(x = 0, y = 0, xend = PC1, yend = PC2), color = 'gray40', arrow = arrow(length = unit(0.05, 'inches'))) +
# geom_text_repel(data = blah$X, aes(x = PC1, y = PC2, label = rownames(blah$X), color = factor(clust_pca)), size = 3, bg.color = 'white') +
geom_text_repel(data = blah$Y, aes(x = PC1 * 1.15, y = PC2 * 1.15, label = rownames(blah$Y)), color = 'gray40', segment.colour = NA) +
theme_bw() +
theme(legend.position = 'none')
ggplot() +
geom_segment(data = blah$Y, aes(x = 0, y = 0, xend = PC1, yend = PC2), color = 'gray40', arrow = arrow(length = unit(0.05, 'inches'))) +
# geom_text_repel(data = blah$X, aes(x = PC1, y = PC2, label = rownames(blah$X), color = factor(clust_pca)), size = 3, bg.color = 'white') +
geom_text_repel(data = blah$Y, aes(x = PC1 * 1.05, y = PC2 * 1.05, label = rownames(blah$Y)), color = 'gray40', segment.colour = NA) +
theme_bw() +
theme(legend.position = 'none')
ggplot() +
geom_segment(data = blah$Y, aes(x = 0, y = 0, xend = PC1, yend = PC2), color = 'gray40', arrow = arrow(length = unit(0.05, 'inches'))) +
# geom_text_repel(data = blah$X, aes(x = PC1, y = PC2, label = rownames(blah$X), color = factor(clust_pca)), size = 3, bg.color = 'white') +
geom_text_repel(data = blah$Y, aes(x = PC1 * 1.1, y = PC2 * 1.1, label = rownames(blah$Y)), color = 'gray40', segment.colour = NA) +
theme_bw() +
theme(legend.position = 'none')
ggplot() +
geom_segment(data = blah$Y, aes(x = 0, y = 0, xend = PC1, yend = PC2), color = 'gray40', arrow = arrow(length = unit(0.05, 'inches'))) +
# geom_text_repel(data = blah$X, aes(x = PC1, y = PC2, label = rownames(blah$X), color = factor(clust_pca)), size = 3, bg.color = 'white') +
geom_text(data = blah$Y, aes(x = PC1 * 1.1, y = PC2 * 1.1, label = rownames(blah$Y)), color = 'gray40', segment.colour = NA) +
theme_bw() +
theme(legend.position = 'none')
ggplot() +
geom_segment(data = blah$Y, aes(x = 0, y = 0, xend = PC1, yend = PC2), color = 'gray40', arrow = arrow(length = unit(0.05, 'inches'))) +
geom_text_repel(data = blah$X, aes(x = PC1, y = PC2, label = rownames(blah$X), color = factor(clust_pca)), size = 3, bg.color = 'white') +
geom_text(data = blah$Y, aes(x = PC1 * 1.1, y = PC2 * 1.1, label = rownames(blah$Y)), color = 'gray40', segment.colour = NA) +
theme_bw() +
theme(legend.position = 'none')
pca <- PCA(clust_dat_z, scale.unit = F, ncp = 2, graph = F)
plot(pca, choix = 'var')
plot(pca, choix = 'ind', add = T)
pca <- PCA(den[,c('Hlth_Un', clust_vars)], scale.unit = T,  ncp = 2, graph = F)
pca <- PCA(den@data[,c('Hlth_Un', clust_vars)], scale.unit = T, quanti.sup = 1,  ncp = 2, graph = F)
sapply(den@data, class)
rm(list = ls())
# Chunk 1: setup
library(rgdal)
library(sf)
library(cluster)
library(RColorBrewer)
library(ggplot2)
library(reshape2)
library(knitr)
source('fastClusterGVF.R') # custom goodness of fit measure
## load example data - Denver census tracts in 2012
den = readOGR(getwd(), 'denver12', verbose = F)
den = den[den$GEOID!='08031980100',] # remove unpopulated tract
# Chunk 2
knitr::include_graphics('figs/singleton_spielman_ex.jpeg')
# Chunk 3
knitr::include_graphics('figs/ecoregions.png')
# Chunk 4
knitr::include_graphics('figs/02_transitions.png')
# Chunk 5
knitr::include_graphics('figs/03_processes.png')
# Chunk 6
## create data
set.seed(808)
a <- data.frame(rnorm(500, mean = 0.5, sd = 0.2) + 5,
rnorm(500) +5)
b <- data.frame(rnorm(500, mean = 0.2, sd = 0.3) + 1,
rnorm(500) +2)
c <- data.frame(rnorm(500, mean = 0.1, sd = 0.25) + 3,
rnorm(500) -3)
## draw groups
plot(a, xlim=c(-2, 9), ylim=c(-7,
9), pch=16, col=4,
xlab = 'Attribute A', ylab = 'Attribute B',
main = 'Clustering in a Perfect World')
points(b, col=2, pch=16)
points(c, col=3, pch=16)
# Chunk 7
knitr::include_graphics('figs/Kmeans_animation.gif')
# Chunk 8
## remove geographic identifiers, x/y coords,
## and test variable (health insurance coverage) from cluster inputs
clust_vars = names(den)[!names(den) %in% c('GEOID', 'Nghbrhd', 'INTPTLA', 'INTPTLO', 'Hlth_Un', 'Hlth_In')]
## generate clustering input dataframe
clust_dat = den@data[,clust_vars]
## standardize (z-score) cluster inputs
clust_dat_z = scale(clust_dat)
## perform clustering
set.seed(909)
kmclust = kmeans(clust_dat_z, centers = 7)$cluster # perform k-means and extract group labels
# Chunk 9
## map the clusters in physical space
den_map = as(den,'sf')
den_map$kmeans_cluster = factor(kmclust)
plot(den_map['kmeans_cluster'],main = paste('Denver Tracts 2012: k-means with k=7 clusters'))
# Chunk 10
knitr::include_graphics('figs/dist_ex.png')
# Chunk 11
knitr::include_graphics('figs/WPGMA_Dendrogram_5S_data.svg')
# Chunk 12
## add neighborhood ids to rownames for readability
rownames(clust_dat_z) = den$Nghbrhd
## generate distance matrix
d = dist(clust_dat_z)
## ward dendrogram
dend = hclust(d = d, method = 'ward.D2')
# Chunk 13
## view the dendrogram
plot(dend)
# Chunk 14
## Specify a range of cluster numbers
krange = 3:10
# goodness of variance fit
gvf = sapply(krange, function(k){
kclust = cutree(dend, k)
fastClusterGVF(dat = clust_dat, clust = kclust)
})
# average silhouette width
sil = sapply(krange, function(k){
kclust = cutree(dend, k)
mean(silhouette(x = kclust, dist = d)[,3])
})
# Chunk 15
## output diagnostics
cl_diag = cbind(k = krange, gvf = gvf, sil = sil)
par(mfrow=c(1,2))
plot(gvf ~ k, data = cl_diag, type='l', main = 'Goodness of Variance Fit')
plot(sil ~ k, data = cl_diag, type='l', main = 'Average Silhouette Width')
# Chunk 16
kable(round(data.frame(cl_diag), 2))
# Chunk 17
## cut dendrogram at best k and assign it to our sf object
best_k = 7
den_map['cluster'] = factor(cutree(dend, best_k))
## plot the map
plot(den_map['cluster'],main = paste('Denver Tracts 2012: k =',best_k,'clusters'))
# Chunk 18
## re-plot map
plot(den_map['cluster'],main = paste('Denver Tracts 2012: k =',best_k,'clusters'))
# Chunk 19
## assign cluster labels to full data
den@data$cluster = factor(cutree(dend, best_k))
## sort clusters by median of outcome variable, highest to lowest
health_uninsured_by_cluster = with(den@data, aggregate(Hlth_Un ~ cluster, FUN = 'median'))
health_uninsured_by_cluster = health_uninsured_by_cluster[order(health_uninsured_by_cluster$Hlth_Un, decreasing = T),]
den$cluster = factor(den$cluster, levels = health_uninsured_by_cluster$cluster)
## plot outcome variable
cols = brewer.pal(best_k, 'Set2')[as.numeric(levels(den$cluster))]
with(den@data, plot(Hlth_Un ~ cluster, col = cols, main = 'Percent of Population without Health Insurance by Cluster', ylab = 'Percent Uninsured'))
abline(h = median(den$Hlth_Un), col = 'red')
# Chunk 20
## generate average profile of a cluster
den_cent = colMeans(clust_dat) # the data centroid
cl = levels(den$cluster)[1] # our target cluster
cl_cent = colMeans(clust_dat[den$cluster==cl,]) # the cluster centroid
avp = (cl_cent - den_cent) / den_cent # difference from data mean
## format the data for plotting
avp_melt = melt(avp)
var_order = rownames(avp_melt)[order(avp_melt$value, decreasing = T)] # plot vars greatest to smallest
avp_melt$variable = factor(rownames(avp_melt), levels = var_order)
cl_col = cols[which(levels(den$cluster) == cl)] # for coloring barplot
ggplot(avp_melt, aes(x = variable, y = value)) +
geom_bar(fill = cl_col, color = 'black', stat = 'identity') +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1)) +
ggtitle(paste('Average Profile for Cluster',cl))
#### PCA clustering ####
library(FactoMineR)
library(fpc)
pca <- PCA(den@data[,c('Hlth_Un', clust_vars)], scale.unit = T, quanti.sup = 1,  ncp = 2, graph = F)
plot(pca, choix = 'var')
plot(pca, choix = 'ind', add = T)
pca_in <- den@data[,c('Hlth_Un', clust_vars)]
rownames(pca_in) <- den$Nghbrhd
pca <- PCA(, scale.unit = T, quanti.sup = 1,  ncp = 2, graph = F)
denx <- den@data[,c('GEOID', 'Nghbrhd')]
denx <- split(denx, denx$Nghbrhd)
for(i in 1:length(denx)){
if(nrow(denx[[i]]) > 1){
denx[[i]]$Nghbrhd <- paste(denx[[i]]$Nghbrhd,
toupper(letters[1:nrow(denx[[i]])]))
}
}
denx <- do.call(rbind, denx)
den$Nghbrhd <- denx$Nghbrhd[match(den$GEOID, denx$GEOID)]
rownames(pca_in) <- den$Nghbrhd
pca <- PCA(pca_in, scale.unit = T, quanti.sup = 1,  ncp = 2, graph = F)
plot(pca, choix = 'var')
plot(pca, choix = 'ind', add = T)
plot(pca, choix = 'ind', cex = 0.5)
?plot.PCA
plot(pca, choix = 'var') %>% class
plot(pca, choix = 'ind', cex = 0.5) +
geom_text_repel()
?plot.pca
plot.PCA
?plot.PCA
pca.scores <- pca$ind$coord
dp = dist(pca.scores)
## ward dendrogram
dendp = hclust(d = dp, method = 'ward.D2')
clust_pca <- cutree(dendp, k = best_k) # use same k for comparison's sake
plot(pca, choix = 'ind', cex = 0.5) +
scale_color_brewer(aes(color = factor(clust_pca)), type = 'qual', palette = 'Set2')
plot(pca, choix = 'ind', cex = 0.5, col.hab = brewer.pal(8, 'Set2')[clust_pca])
plot(pca, choix = 'ind', cex = 0.5, hab = 'ind', col.hab = brewer.pal(8, 'Set2')[clust_pca])
plot(pca, choix = 'ind', cex = 0.5, habillage = 'ind', col.hab = brewer.pal(8, 'Set2')[clust_pca])
plot(pca, choix = 'ind', cex = 0.5, habillage = factor(clust_pca))
plot(pca, choix = 'ind', cex = 0.5)
plot(pca, choix = 'var')
cowplot::plot_grid(
plot(pca, choix = 'var'),
plot(pca, choix = 'ind', cex = 0.5),
ncol = 1
)
plot(pca, choix = 'var') +
geom_point(data = pca.scores, aes(x = PC1, y = PC2, color = factor(clust_pca)))
pca.scores <- data.frame(pca$ind$coord)
plot(pca, choix = 'var') +
geom_point(data = pca.scores, aes(x = PC1, y = PC2, color = factor(clust_pca)), inherit.aes = F)
head(pca.scores)
plot(pca, choix = 'var') +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F)
pca.scores <- data.frame(scale(pca$ind$coord))
plot(pca, choix = 'var') +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F)
plot(den_map[c('cluster', 'clust_pca')], lwd = 0.1)
den_map['clust_pca'] <- factor(clust_pca)
plot(den_map['cluster'], lwd = 0.1)
plot(den_map['clust_pca'], lwd = 0.1)
cowplot::plot_grid(
plot(pca, choix = 'var'),
plot(pca, choix = 'ind', cex = 0.5),
nrow = 1
)
plot(pca, choix = 'var') +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2')
plot(pca, choix = 'var', ellipse = F, shadowtext = T)
plot(pca, choix = 'var', shadowtext = T) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2')
plot(pca, choix = 'var', shadowtext = T, ggoptions = list(cex = 0.5)) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2')
plot(pca, choix = 'var', shadowtext = T, cex = 0.5) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2')
plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2')
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2')
map_pca <- ggplot(data = den_map, aes(fill = clust_pca)) +
geom_sf() +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme_void() +
theme(legend.position = 'none')
map_pca
map_pca <- ggplot(data = den_map, aes(fill = clust_pca)) +
geom_sf(size = 0.1, color = 'black') +
scale_fill_brewer(type = 'qual', palette = 'Set2') +
theme_void() +
theme(legend.position = 'none')
map_pca
cowplot::plot_grid(map_pca, plt_pca, nrow = 1)
cowplot::plot_grid(map_pca, plt_pca, ncol = 1)
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
guides(color = 'Cluster')
map_pca <- ggplot(data = den_map, aes(fill = clust_pca)) +
geom_sf(size = 0.1, color = 'black') +
scale_fill_brewer(type = 'qual', palette = 'Set2') +
theme_void() +
theme(legend.position = 'none')
cowplot::plot_grid(map_pca, plt_pca, ncol = 1)
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
labs(color = 'Cluster')
map_pca <- ggplot(data = den_map, aes(fill = clust_pca)) +
geom_sf(size = 0.1, color = 'black') +
scale_fill_brewer(type = 'qual', palette = 'Set2') +
theme_void() +
theme(legend.position = 'none')
cowplot::plot_grid(map_pca, plt_pca, ncol = 1)
plt_pca
## generate average profile of a cluster
den_cent = colMeans(clust_dat) # the data centroid
cl = levels(den$cluster)[1] # our target cluster
cl_cent = colMeans(clust_dat[den$cluster==cl,]) # the cluster centroid
avp = (cl_cent - den_cent) / den_cent # difference from data mean
avp = avp[avp > 0]
## format the data for plotting
avp_melt = melt(avp)
var_order = rownames(avp_melt)[order(avp_melt$value, decreasing = T)] # plot vars greatest to smallest
avp_melt$variable = factor(rownames(avp_melt), levels = var_order)
cl_col = cols[which(levels(den$cluster) == cl)] # for coloring barplot
ggplot(avp_melt, aes(x = variable, y = value)) +
geom_bar(fill = cl_col, color = 'black', stat = 'identity') +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1)) +
ggtitle(paste('Average Profile for Cluster',cl))
rm(list = ls())
# Chunk 1: setup
library(rgdal)
library(sf)
library(cluster)
library(RColorBrewer)
library(ggplot2)
library(reshape2)
library(knitr)
source('fastClusterGVF.R') # custom goodness of fit measure
## load example data - Denver census tracts in 2012
den = readOGR(getwd(), 'denver12', verbose = F)
den = den[den$GEOID!='08031980100',] # remove unpopulated tract
# Chunk 2
knitr::include_graphics('figs/singleton_spielman_ex.jpeg')
# Chunk 3
knitr::include_graphics('figs/ecoregions.png')
# Chunk 4
knitr::include_graphics('figs/02_transitions.png')
# Chunk 5
knitr::include_graphics('figs/03_processes.png')
# Chunk 6
## create data
set.seed(808)
a <- data.frame(rnorm(500, mean = 0.5, sd = 0.2) + 5,
rnorm(500) +5)
b <- data.frame(rnorm(500, mean = 0.2, sd = 0.3) + 1,
rnorm(500) +2)
c <- data.frame(rnorm(500, mean = 0.1, sd = 0.25) + 3,
rnorm(500) -3)
## draw groups
plot(a, xlim=c(-2, 9), ylim=c(-7,
9), pch=16, col=4,
xlab = 'Attribute A', ylab = 'Attribute B',
main = 'Clustering in a Perfect World')
points(b, col=2, pch=16)
points(c, col=3, pch=16)
# Chunk 7
knitr::include_graphics('figs/Kmeans_animation.gif')
# Chunk 8
## remove geographic identifiers, x/y coords,
## and test variable (health insurance coverage) from cluster inputs
clust_vars = names(den)[!names(den) %in% c('GEOID', 'Nghbrhd', 'INTPTLA', 'INTPTLO', 'Hlth_Un', 'Hlth_In')]
## generate clustering input dataframe
clust_dat = den@data[,clust_vars]
## standardize (z-score) cluster inputs
clust_dat_z = scale(clust_dat)
## perform k-means clustering and extract group labels
set.seed(909)
kmclust = kmeans(clust_dat_z, centers = 7)$cluster
# Chunk 9
## map the clusters in physical space
den_map = as(den,'sf')
den_map$kmeans_cluster = factor(kmclust)
plot(den_map['kmeans_cluster'],main = paste('Denver Tracts 2012: k-means with k=7 clusters'))
# Chunk 10
knitr::include_graphics('figs/dist_ex.png')
# Chunk 11
knitr::include_graphics('figs/WPGMA_Dendrogram_5S_data.svg')
# Chunk 12
knitr::include_graphics('figs/WPGMA_Dendrogram_5S_data.svg')
# Chunk 13
## add neighborhood ids to rownames for readability
rownames(clust_dat_z) = den$Nghbrhd
## generate distance matrix
d = dist(clust_dat_z)
## ward dendrogram
dend = hclust(d = d, method = 'ward.D2')
# Chunk 14
## view the dendrogram
plot(dend)
# Chunk 15
## Specify a range of cluster numbers
krange = 3:10
# goodness of variance fit
gvf = sapply(krange, function(k){
kclust = cutree(dend, k)
fastClusterGVF(dat = clust_dat, clust = kclust)
})
# average silhouette width
sil = sapply(krange, function(k){
kclust = cutree(dend, k)
mean(silhouette(x = kclust, dist = d)[,3])
})
# Chunk 16
## output diagnostics
cl_diag = cbind(k = krange, gvf = gvf, sil = sil)
par(mfrow=c(1,2))
plot(gvf ~ k, data = cl_diag, type='l', main = 'Goodness of Variance Fit')
plot(sil ~ k, data = cl_diag, type='l', main = 'Average Silhouette Width')
# Chunk 17
kable(round(data.frame(cl_diag), 2))
# Chunk 18
## cut dendrogram at best k and assign it to our sf object
best_k = 7
den_map['cluster'] = factor(cutree(dend, best_k))
## plot the map
plot(den_map['cluster'],main = paste('Denver Tracts 2012: k =',best_k,'clusters'))
# Chunk 19
## re-plot map
plot(den_map['cluster'],main = paste('Denver Tracts 2012: k =',best_k,'clusters'))
# Chunk 20
## assign cluster labels to full data
den@data$cluster = factor(cutree(dend, best_k))
## sort clusters by median of outcome variable, highest to lowest
health_uninsured_by_cluster = with(den@data, aggregate(Hlth_Un ~ cluster, FUN = 'median'))
health_uninsured_by_cluster = health_uninsured_by_cluster[order(health_uninsured_by_cluster$Hlth_Un, decreasing = T),]
den$cluster = factor(den$cluster, levels = health_uninsured_by_cluster$cluster)
## plot outcome variable
cols = brewer.pal(best_k, 'Set2')[as.numeric(levels(den$cluster))]
with(den@data, plot(Hlth_Un ~ cluster, col = cols, main = 'Percent of Population without Health Insurance by Cluster', ylab = 'Percent Uninsured'))
abline(h = median(den$Hlth_Un), col = 'red')
# Chunk 21
## generate average profile of a cluster
den_cent = colMeans(clust_dat) # the data centroid
cl = levels(den$cluster)[1] # our target cluster
cl_cent = colMeans(clust_dat[den$cluster==cl,]) # the cluster centroid
avp = (cl_cent - den_cent) / den_cent # difference from data mean
avp = avp[avp > 0] # limit to variables above the Denver mean
## format the data for plotting
avp_melt = melt(avp)
var_order = rownames(avp_melt)[order(avp_melt$value, decreasing = T)] # plot vars greatest to smallest
avp_melt$variable = factor(rownames(avp_melt), levels = var_order)
cl_col = cols[which(levels(den$cluster) == cl)] # for coloring barplot
ggplot(avp_melt, aes(x = variable, y = value)) +
geom_bar(fill = cl_col, color = 'black', stat = 'identity') +
theme_bw() +
theme(axis.text.x=element_text(angle=45,hjust=1)) +
ggtitle(paste('Average Profile for Cluster',cl))
library(FactoMineR)
## build the PCA inputs
pca_in <- den@data[,c('Hlth_Un', clust_vars)] # we will impose the 'no health insurance' variable in the PCA space
rownames(pca_in) <- den$Nghbrhd # assign neighborhood IDs
pca <- PCA(pca_in, scale.unit = T, quanti.sup = 1,  ncp = 2, graph = F) # perform PCA (z-scoring handled internally)
library(FactoMineR)
## build the PCA inputs
pca_in <- den@data[,c('Hlth_Un', clust_vars)] # we will impose the 'no health insurance' variable in the PCA space
# rownames(pca_in) <- den$Nghbrhd # assign neighborhood IDs
pca <- PCA(pca_in, scale.unit = T, quanti.sup = 1,  ncp = 2, graph = F) # perform PCA (z-scoring handled internally)
library(FactoMineR)
## build the PCA inputs
pca_in <- den@data[,c('Hlth_Un', clust_vars)] # we will impose the 'no health insurance' variable in the PCA space
# rownames(pca_in) <- den$Nghbrhd # assign neighborhood IDs
pca <- PCA(pca_in, scale.unit = T, quanti.sup = 1,  ncp = 2, graph = F) # perform PCA (z-scoring handled internally)
## plot PCA loadings
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8)
pca.scores <- data.frame(scale(pca$ind$coord))
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = factor(clust_pca)), inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
labs(color = 'Cluster')
plt_pca
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2), color = 'gray40', inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
labs(color = 'Cluster')
plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2), color = 'gray40', inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
labs(color = 'Cluster')
## extract PCA scores (projections of each case)
pca.scores <- data.frame(scale(pca$ind$coord))
## cluster using Ward's method
# use same k as above, for comparison's sake
dp = dist(pca.scores)
dendp = hclust(d = dp, method = 'ward.D2')
clust_pca <- cutree(dendp, k = best_k)
clust_pca <- factor(clust_pca) # for plotting
## assign clusters to map data
den_map['clust_pca'] <- factor(clust_pca)
## make plots
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2), color = 'gray40', inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
labs(color = 'Cluster')
map_pca <- ggplot(data = den_map, aes(fill = clust_pca)) +
geom_sf(size = 0.1, color = 'black') +
scale_fill_brewer(type = 'qual', palette = 'Set2') +
theme_void() +
theme(legend.position = 'none')
## display plots
plot_grid(map_pca, plt_pca, ncol = 1)
library(cowplot)
rownames(pca.scores)
which(den$Nghbrhd == 'Sun Valley')
plt_pca
## make plots
plt_pca <- plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores[-100,], aes(x = Dim.1, y = Dim.2, color = clust_pca), size = 4, alpha = 0.5, inherit.aes = F) + # omit Sun Valley (outlier)
scale_color_brewer(type = 'qual', palette = 'Set2') +
labs(color = 'Cluster')
plt_pca
########
plot(pca, choix = 'var', shadowtext = T, cex = 0.8) +
geom_point(data = pca.scores, aes(x = Dim.1, y = Dim.2, color = clust_pca), size = 5, alpha = 0.4, inherit.aes = F) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
labs(color = 'Cluster')
